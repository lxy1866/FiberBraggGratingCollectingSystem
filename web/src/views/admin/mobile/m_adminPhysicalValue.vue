<template>
  <MTheHeader/>
  <n-card
      title="ğŸ“– è®¾ç½®å…‰çº¤å…‰æ …ä¼ æ„Ÿå™¨é˜µåˆ—çš„å‚æ•°é‡ç¨‹ä»¥åŠåˆå§‹ä½ç½®"
      embedded
      :bordered="false"
  >
    æ¯ä¸ªå…‰çº¤å…‰æ …ä¼ æ„Ÿå™¨éƒ½æœ‰è‡ªå·±çš„åº”å˜é‡ç¨‹ï¼ˆå¦‚æœæ˜¯æ¸©åº¦ä¼ æ„Ÿå™¨åˆ™ä¸ºæ¸©åº¦é‡ç¨‹ï¼Œå¦‚æœæ˜¯æŒ¯åŠ¨ä¸ºæŒ¯åŠ¨é‡ç¨‹ï¼‰ï¼Œè¶…å‡ºèŒƒå›´çš„è®°å½•ä¼šè¢«å±•ç¤ºåˆ°å¼‚å¸¸æ³¢åŠ¨æ•°æ®é¡µé¢ä¸­ã€‚<br/>
    å‚æ•°ä¸€æ—¦è®¾ç½®å°±ä¸èƒ½ä¿®æ”¹ï¼Œå¦‚æœçœŸçš„éœ€è¦ä¿®æ”¹ï¼Œè¯·è”ç³»ç®¡ç†å‘˜è·å–æˆæƒç ã€‚æ³¨æ„ï¼šå…ˆç‚¹å‡»é‡æ–°ä¿®æ”¹å†ç‚¹å‡»ç¡®è®¤æäº¤ï¼Œä¼ æ„Ÿå™¨ç±»åˆ«ï¼šåº”å˜å¡«1ï¼Œæ¸©åº¦å¡«2ï¼ŒæŒ¯åŠ¨å¡«3
  </n-card>
    <!-- æ¯ä¸ªå…ƒç´ çš„ä¸¤ä¾§é—´éš”ç›¸ç­‰ -->

    <div style="padding-top: 10px">
      <van-row justify="space-between" >
        <van-col span="16" offset="1">
          <p class="fontClass">è¯·å…ˆè¾“å…¥å…‰çº¤å…‰æ …ä¼ æ„Ÿé˜µåˆ—çš„ä¸ªæ•°ï¼š</p>
        </van-col>
      </van-row>
      <van-row justify="space-between">
        <van-col span="16" offset="1">
          <n-input-number  style="width: 70%" v-model:value="inputNum" />
        </van-col>
      </van-row>
      <br/>
      <van-row justify="space-around">
        <van-col span="22">
          <p class="fontClass" >è¯·è¾“å…¥æ¯ä¸ªå…‰çº¤å…‰æ …ä¼ æ„Ÿé˜µåˆ—çš„åº”å˜å€¼çš„é‡ç¨‹ï¼ˆæˆ–è€…æ¸©åº¦é‡ç¨‹ï¼ŒæŒ¯åŠ¨é‡ç¨‹ï¼‰ä»¥åŠåˆå§‹ä½ç½®ï¼š</p>
        </van-col>
      </van-row>
      <n-form :model="model" >
        <n-dynamic-input
            v-model:value="model.dynamicInputValue"
            item-style="margin-bottom: 0;"
            :on-create="onCreate"
            #="{ index, value }"
            :min="inputNum"
            :max="inputNum"

        >
          <van-row justify="space-around">
            <van-col span="20">
              <n-form-item
                  ignore-path-change
                  :show-label="false"
                  :path="`dynamicInputValue[${index}].minValue`"
                  :rule="dynamicInputRule"
              >
                <n-input
                    v-model:value="model.dynamicInputValue[index].minValue"
                    placeholder="minValue"
                    @keydown.enter.prevent

                />
              </n-form-item>
              <n-form-item
                  ignore-path-change
                  :show-label="false"
                  :path="`dynamicInputValue[${index}].name`"
                  :rule="dynamicInputRule"
              >
                <n-input
                    v-model:value="model.dynamicInputValue[index].name"
                    placeholder="name"
                    @keydown.enter.prevent

                />
                <!--
                  ç”±äºåœ¨ input å…ƒç´ é‡ŒæŒ‰å›è½¦ä¼šå¯¼è‡´ form é‡Œé¢çš„ button è¢«ç‚¹å‡»ï¼Œæ‰€ä»¥é˜»æ­¢äº†é»˜è®¤è¡Œä¸º
                -->
              </n-form-item>
              <n-form-item
                  ignore-path-change
                  :show-label="false"
                  :path="`dynamicInputValue[${index}].maxValue`"
                  :rul="dynamicInputRule"
              >
                <n-input
                    v-model:value="model.dynamicInputValue[index].maxValue"
                    placeholder="maxValue"
                    @keydown.enter.prevent

                />
              </n-form-item>
            </van-col>
          </van-row >
          <van-row justify="space-around">
            <van-col span="28">
              <n-form-item
                  ignore-path-change
                  :show-label="false"
                  :path="`dynamicInputValue[${index}].distance`"
                  :rul="dynamicInputRule"
              >
                <n-input
                    v-model:value="model.dynamicInputValue[index].distance"
                    placeholder="åˆå§‹ä½ç½®"
                    @keydown.enter.prevent

                />
              </n-form-item>
              <n-form-item
                  ignore-path-change
                  :show-label="false"
                  :path="`dynamicInputValue[${index}].category`"
                  :rul="dynamicInputRule"
              >
                <n-input
                    v-model:value="model.dynamicInputValue[index].category"
                    placeholder="ä¼ æ„Ÿå™¨ç±»åˆ«"
                    @keydown.enter.prevent
                    style="height: 100%;"
                />
              </n-form-item>
              <n-form-item
                  ignore-path-change
                  :show-label="false"
                  :path="`dynamicInputValue[${index}].channel`"
                  :rul="dynamicInputRule"
              >
                <n-input
                    v-model:value="model.dynamicInputValue[index].channel"
                    placeholder="é€šé“å·"
                    @keydown.enter.prevent
                    style="height: 100%;"
                />
              </n-form-item>
              <n-form-item
                  ignore-path-change
                  :show-label="false"
                  :path="`dynamicInputValue[${index}].arrayNum`"
                  :rul="dynamicInputRule"
              >
                <n-input
                    v-model:value="model.dynamicInputValue[index].arrayNum"
                    placeholder="é˜µåˆ—åºå·"
                    @keydown.enter.prevent
                    style="height: 100%;"
                />
              </n-form-item>
            </van-col>
          </van-row>
        </n-dynamic-input>
        <n-popconfirm
            @positive-click="handlePositiveClick"
            @negative-click="handleNegativeClick"
        >
          <template #trigger>
            <n-button round :disabled="code !== 'test'" style="margin-left: 35px;">
              ç¡®è®¤æäº¤
            </n-button>
          </template>
          æ˜¯å¦è®¾ç½®å®Œå‚æ•°ï¼Ÿ
        </n-popconfirm>
        <n-popconfirm
            @positive-click="handlePopModifyFrame"
            @negative-click="handleNegativeClick"
        >
          <template #trigger>
            <n-button round style="margin-left: 115px;--n-text-color: #9ebad6">
              é‡æ–°ä¿®æ”¹
            </n-button>
          </template>
          æ˜¯å¦é‡æ–°è®¾ç½®å‚æ•°ï¼Ÿ
        </n-popconfirm>
        <n-modal
            v-model:show="showModalRef"
            :mask-closable="false"
            preset="dialog"
            title="è¾“å…¥æˆæƒç "
            positive-text="ç¡®è®¤"
            negative-text="å–æ¶ˆ"
            @positive-click="onPositiveClick"
            @negative-click="onNegativeClick"
        >
          <n-input
              v-model:value="code"
              type="password"
              show-password-on="mousedown"
              placeholder="å¯†ç "
              :maxlength="8"
          />
        </n-modal>
      </n-form>
      <pre style="color: rgb(190 202 214)">{{ JSON.stringify(model.dynamicInputValue, null, 3) }}</pre>
    </div>
  <div style="height: 30px;"></div>
  <MTheFooter/>
</template>
<script lang="ts">
import MTheHeader from '@/components/mobile/m_theHeader.vue';
import MTheFooter from '@/components/mobile/m_theFooter.vue';
import axios from 'axios';
import {defineComponent, onMounted, ref, watch} from "vue";
import {message} from "ant-design-vue";
const model = ref({
  dynamicInputValue: [{ minValue:'',name: '',maxValue: '',distance:'', category:'',channel:'',arrayNum:''}]
})

const code = ref();
let inputNum = ref(null);
const handlePositiveClick  = () =>{
  console.log(inputNum.value)
  if(model.value.dynamicInputValue.length === inputNum.value){
    //è¯·æ±‚åç«¯æ¥å£ä¿å­˜6ä¸ªèŒƒå›´å€¼
    axios.post("/nr/save", model.value.dynamicInputValue).then((response) => {
      const data = response.data;
      if (data.success) {
        message.success("ä¿å­˜æˆåŠŸ");
        code.value = "";
      } else {
        message.error(data.message);
      }
    });
  }else{
    console.log("model.value.dynamicInputValueçš„ç±»å‹", typeof model.value.dynamicInputValue)
    message.info("è¾“å…¥çš„å…‰çº¤å…‰æ …ä¼ æ„Ÿé˜µåˆ—çš„ä¸ªæ•°ä¸è®¾ç½®çš„å‚æ•°èŒƒå›´ä¸ªæ•°ä¸åŒ¹é…ï¼")
  }
};
export default defineComponent({
  name: 'm_admin-physicalValue',
  components:{
    MTheHeader,
    MTheFooter
  },
  setup(){
    const showModalRef = ref(false)
    const onNegativeClick =()=> {
      message.success('Cancel')
      showModalRef.value = false
    };
    const onPositiveClick = ()=> {
      //éªŒè¯æˆæƒç æ˜¯å¦æ­£ç¡®
      if(code.value === 'test'){
        message.success('æˆæƒç æ­£ç¡®')
        showModalRef.value = false
      }else{
        message.success('æˆæƒç é”™è¯¯')
      }
    }
    const handleNegativeClick =()=> {
      message.info('å–æ¶ˆæˆåŠŸ')
    }
    const handlePopModifyFrame = ()=>{
      showModalRef.value = true
    }
    const height_top = ref({
      height: ''
    });
    const windowHeight = ref({
      height: ''
    })
    onMounted(()=>{
      watch(inputNum,(newValue, oldValue)=>{
        console.log(newValue,oldValue);
      })
    })
    return {
      dynamicInputRule: {
        trigger: 'input',
        // validator (rule: unknown, value: string) {
        //   //if (value.length >= 15) return new Error('æœ€å¤šè¾“å…¥15ä¸ªå­—ç¬¦')
        //   return true
        // }
      },
      model,
      onCreate () {
        return {
          minValue:'',
          name: '',
          maxValue:'',
          distance:'',
          category:'',
          channel:'',
          arrayNum:''
        }
      },
      handlePositiveClick,
      handleNegativeClick,
      onPositiveClick,
      onNegativeClick,
      showModalRef,
      handlePopModifyFrame,
      code,
      height_top,
      windowHeight,
      inputNum
    }
  }
})
</script>
<style scoped>
.fontClass{
  font-family:-apple-system,BlinkMacSystemFont,Helvetica Neue,Helvetica,Segoe UI,Arial,Roboto,PingFang SC,miui,Hiragino Sans GB,Microsoft Yahei,sans-serif;;
  color:  rgb(190 202 214);
}


</style>